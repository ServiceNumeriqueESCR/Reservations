services:
  db:
    image: linuxserver/mariadb:10.6.13
    restart: always
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Paris
      - MYSQL_ROOT_PASSWORD=${LB_DATABASE_PWD}
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=${LB_DATABASE_NAME}
      - MYSQL_USER=${LB_DATABASE_USER}
      - MYSQL_PASSWORD=${LB_DATABASE_PWD}
    
    volumes:
      - db_data:/config
    networks:
      - dokploy-network

  app:
    image: librebooking/librebooking:4.0.0
    restart: always
    depends_on:
      - db
    environment:
      - LB_DATABASE_HOSTSPEC=db
      - LB_DATABASE_NAME=${LB_DATABASE_NAME}
      - LB_DATABASE_USER=${LB_DATABASE_USER}
      - LB_DATABASE_PWD=${LB_DATABASE_PWD}
      - LB_INSTALL_PWD=${LB_INSTALL_PWD}
      - LB_DEFAULT_TIMEZONE=Europe/Paris
      - LB_APP_TITLE=RÃ©servations ESCR
      - LB_ADMIN_EMAIL=${LB_ADMIN_EMAIL}
    volumes:
      - app_config:/config
      # Si tu veux plus tard article.json + data :
      # - ./article.json:/var/www/html/article.json
      # - ./data:/var/www/html/data
    networks:
      - dokploy-network
      - publish 80:80
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.resa-escr.rule=Host(`reservation.escr.fr`)"
      - "traefik.http.routers.resa-escr.entrypoints=websecure"
      - "traefik.http.routers.resa-escr.tls.certResolver=letsencrypt"
      - "traefik.http.services.resa-escr.loadbalancer.server.port=80"

volumes:
  db_data:
  app_config:

networks:
  dokploy-network:
    external: true
